<div class="modal-backdrop" @onclick="Close">
    <div class="modal-card" @onclick:stopPropagation>
        <h3>@Habit.Name</h3>

        @if (Habit.IsValueBased)
        {
            <input type="number"
                   min="1"
                   inputmode="numeric"
                   placeholder="Add amount"
                   @bind="amount"
                   @bind:event="oninput"
                   @onkeydown="OnKeyDown" />

            <button class="habit-btn large"
                    disabled="@(amount <= 0)"
                    @onclick="SubmitValue">
                Add
            </button>
        }
        else
        {
            <button class="habit-btn large"
                    @onclick="SubmitComplete">
                Done
            </button>
        }
    </div>
</div>

@code {
    [Parameter, EditorRequired]
    public HabitTodayDto Habit { get; set; } = default!;

    // 🔹 value-based
    [Parameter]
    public EventCallback<int> OnAddValue { get; set; }

    // 🔹 binary
    [Parameter]
    public EventCallback OnComplete { get; set; }

    [Parameter]
    public EventCallback OnClose { get; set; }

    int amount;

    async Task SubmitValue()
    {
        if (amount <= 0)
            return;

        await OnAddValue.InvokeAsync(amount);
        await Close();
    }

    async Task SubmitComplete()
    {
        await OnComplete.InvokeAsync();
        await Close();
    }

    async Task Close()
    {
        amount = 0;
        await OnClose.InvokeAsync();
    }

    async Task OnKeyDown(KeyboardEventArgs e)
    {
        if (e.Key == "Enter" && Habit.IsValueBased)
            await SubmitValue();
    }
}
